# Тестовое задание

## Описание

Сделано:
1. Создан `docker-compose` файл, который запускает следующие сервисы:
    - Веб-приложение на FastAPI с несколькими эндпоинтами:
        - GET 'api/v1/messages/' - показывает список всех сообщений;
        - POST 'api/v1/message/' - позволяет написать сообщение.
    - Веб-сервер Nginx.
    - MongoDB в качестве базы данных для сообщений.
    - Телеграм-бот (aiogram3), который показывает сообщения и позволяет создать сообщение самому.
2. Добавлено кэширование с помощью Redis (кэш стирается при добавлении нового сообщения).
3. Приложение развернуто на удалённом сервере и добавлен SSL через Certbot.
4. Реализован код так, чтобы было видно, кто написал сообщение.
5. Добавлена пагинация для списка сообщений.

## Установка и запуск

1. Клонируйте репозиторий на ваш локальный компьютер:
    ```bash
    git clone https://github.com/lolevan/fastapi-telegram-bot-docker.git
    cd fastapi-telegram-bot-docker
    ```

2. Создайте файл `.env` в корневой директории проекта и добавьте туда следующие переменные:
    ```
    TELEGRAM_API_TOKEN=ваш_токен
    WEB_APP_URL=http://ваш_url_приложения
    ```

3. Запустите Docker Compose:
    ```bash
    docker-compose up --build
    ```

4. Веб-приложение будет доступно по адресу `http://localhost:8000`, а Nginx будет работать на порту `80`.

## Эндпоинты веб-приложения

- `GET /api/v1/messages/` - возвращает список всех сообщений.
- `POST /api/v1/message/` - добавляет новое сообщение. Пример тела запроса:
    ```json
    {
        "content": "Текст сообщения",
        "author": "Имя автора"
    }
    ```

## Телеграм-бот

Бот поддерживает следующие команды:
- `/start` и `/help` - приветственное сообщение.
- `/messages` - показывает список всех сообщений.
- `/new_message <текст>` - отправляет новое сообщение от имени пользователя.

## Кэширование

Кэширование реализовано с помощью Redis. Кэш автоматически стирается при добавлении нового сообщения.

## Развертывание на удалённом сервере с SSL

1. Установите Docker и Docker Compose на удалённый сервер.
2. Клонируйте репозиторий и настройте переменные окружения в файле `.env`.
3. Запустите Docker Compose:
    ```bash
    docker-compose up --build
    ```
4. Установите Certbot и настройте SSL для вашего домена. Пример команды для Nginx:
    ```bash
    sudo certbot --nginx -d your_domain.com
    ```

5. Перезапустите сервисы, чтобы применить изменения:
    ```bash
    docker-compose down
    docker-compose up --build
    ```

## Пагинация

Пагинация реализована для эндпоинта `GET /api/v1/messages/`. Для получения следующей страницы сообщений используйте параметры `page` и `size`:
- `page` - номер страницы (начиная с 1).
- `size` - количество сообщений на странице.

Пример запроса:

```bash
  GET /api/v1/messages/?page=1&size=10
```

